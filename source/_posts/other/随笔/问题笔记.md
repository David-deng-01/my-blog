---
title: 问题笔记
layout: post
tags:
  - 笔记
  - 其他
categories:
  - 笔记
  - Other
lang: zh-CN
abbrlink: 121
date: 2023-10-11 16:25:00
---

# 遇到的问题&解决方案【持续更新~】

## 2023-09-16 笔记

### 解决 MP4 视频转成 m3u8 格式的问题

1. 需求描述：

   现在需要批量将一些存放在文件夹下的 MP4 视频转成 m3u8 格式，其中视频存放的位置可能是多层文件夹下，m3u8 视频需要分门别类的存放

2. 解决思路

   1. 使用 `Python` + `ffmpeg` 实现视频的转码
   2. 使用多线程加速视频的转码

3. 遇到的问题

   1. 多个视频不能按照预设的顺序进行转码，前一个视频还没有完成，下一个视频就中断了前一个视频的转码
   2. 本机的性能不足，需要放在服务器上运行，但是服务器上的`Linux`环境导致运行出现一些没有预测到的问题

4. 最终解决方案

   1. 不使用多线程运行
   2. 使用`Python` 创建好输出的路径以及视频转码的命令
   3. 手动输入转码的命令，顺序进行视频转码

5. 最终的代码如下：

   ```python
   # -*-coding: Utf-8 -*-
   # @Project Name: GithubCopilot试用
   # @File: mp4转m3u8.py
   # @Author: David
   # @Date：2023/9/11 21:34
   import argparse
   import os
   from argparse import ArgumentParser, Namespace
   from multiprocessing import pool
   from typing import Dict, Tuple, List
   
   # from ffmpeg import _ffmpeg as ffmpeg
   import hydra
   from omegaconf import DictConfig, OmegaConf
   
   
   def get_file_path_list(input_dir: str) -> List[str]:
       """
           获取文件目录下的所有 mp4 文件
           :param input_dir: 输入目录
           :return: 输入目录中所有 mp4 文件的路径
       """
       result: List[str] = list()
       for path in os.listdir(input_dir):
           path = os.path.join(input_dir, path)
           if os.path.isdir(path):
               result.extend(get_file_path_list(path))
           else:
               if path.split('.')[-1].lower() == 'mp4':
                   result.append(path)
       return result
   
   
   def handle_file(mp4_file: str, m3u8_file: str, mp4_filename: str, out_folder_path: str) -> bool:
       """
           处理指定的 mp4 文件
           :param out_folder_path: 输出文件夹
           :param mp4_file: MP4输入文件
           :param m3u8_file: m3u8文件输出路径
           :param mp4_filename: MP4文件名
           :return:
       """
       # log(f"开始处理, 文件名:{mp4_filename}", cnt=40)
       # print(f"mp4_file >> {mp4_file}")
       # print(f"m3u8_file >> {m3u8_file}")
       #
       # s1 = (f'ffmpeg -i {mp4_file} -profile:v baseline -level 3.0 -start_number 0 '
       #       f'-hls_time 10 -hls_list_size 0 -f hls {m3u8_file}')
       # print(s1)
       # s2 = (f'ffmpeg -i {m3u8_file} -vcodec copy '
       #       f'-acodec copy -absf aac_adtstoasc {mp4_file}')
       #
       # # subprocess.Popen(s1)
       # # subprocess.Popen(s2)
       # os.popen(s1)
       # # os.popen(s2)
       # try:
       #     ffmpeg.input(mp4_file).output(m3u8_file, format='hls', hls_time=10, hls_segment_type='mpegts').run()
       #     return True
       # except Exception as e:
       #     print(f"An error occurred during video conversion: {e}")
       #     return False
       # ts_file = os.path.join(out_folder_path, '%05d.ts')
       s1 = (
           f'&& ffmpeg '
           f'-hwaccel cuda -hwaccel_device 0 '
           f'-i {mp4_file} '
           f'-profile:v baseline '
           f'-level 3.0 '
           f'-start_number 0 '
           f'-hls_time 10 '
           f'-hls_list_size 0 '
           f'-f hls {m3u8_file}'
       )
       print(s1)
   
   
   def handle_folder(input_dir, output_dir, worker: int = 1) -> int:
       """
           处理整个 input_dir 文件夹下的所有 mp4 文件
           :param input_dir:  输入文件夹
           :param output_dir:  输出文件夹
           :param worker: 进程数量
           :return: 处理文件数量
       """
       log(f"程序开始, 输入文件夹: {os.path.abspath(input_dir)}")
   
       # 获取 input_dir 路径下的所有 json 文件路径
       file_path_list: List[str] = get_file_path_list(input_dir)
   
       # 多进程调用函数
       p = pool.Pool(worker)
   
       for index, mp4_file in enumerate(file_path_list):
           # 从文件路径中获取文件名称, 有后缀名
           mp4_filename = os.path.basename(mp4_file)
           m3u8_filename = f"{os.path.splitext(mp4_filename)[0]}.m3u8"
           folder_list: List[str] = mp4_filename.split('：')[0].split('_')  # 第几季 第几期, 例如: 第3季 第2期
           out_folder_path: str = os.path.join(output_dir, *folder_list)
           os.makedirs(out_folder_path, exist_ok=True)
           m3u8_file = os.path.join(out_folder_path, m3u8_filename)
           # 处理单个文件
           # handle_file(mp4_file, out_folder_path, mp4_filename)
   
           p.apply_async(
               handle_file,
               args=(mp4_file, m3u8_file, mp4_filename, out_folder_path)
           )
   
       p.close()
       p.join()
   
       return len(file_path_list)
   
   
   def get_args(config) -> Tuple[str, str]:
       # 输出日志
       log("加载配置文件")
   
       parser: ArgumentParser = argparse.ArgumentParser()
       parser.add_argument('--input_dir', type=str)  # 字幕文件夹
       parser.add_argument('--output_dir', type=str)  # 输出文件夹
       args: Namespace = parser.parse_args()
   
       if args.input_dir is not None:
           config['input_dir'] = args.input_dir
       if args.output_dir is not None:
           config['output_dir'] = args.output_dir
   
       # 获取输入输出文件夹, 优先级 CMD > 配置文件
       input_dir: str = os.path.join(os.path.abspath(os.getcwd()), config['input_dir'])
       output_dir: str = os.path.join(os.path.abspath(os.getcwd()), config['output_dir'])
   
       return input_dir, output_dir
   
   
   def log(msg: str, separator: str = '-', cnt: int = 80):
       """
       日志输出
       :param msg: 日志信息
       :param separator: 分隔符
       :param cnt:  分隔符号数量
       :return:
       """
       print(separator * cnt)
       print(f"Message: {msg}")
   
   
   @hydra.main(config_path="config", config_name="video", version_base="1.3.2")
   def main(config: DictConfig) -> None:
       # 加载配置文件
       config: Dict = OmegaConf.to_container(config, resolve=True)
       input_dir, output_dir = get_args(config)
   
       # 创建输出目录
       os.makedirs(output_dir, exist_ok=True)
   
       # 处理 mp4 文件
       total = handle_folder(input_dir, output_dir, config['worker'])
   
       log(f"程序结束, 共处理: {total} 个文件, 输出文件夹: {os.path.abspath(output_dir)}")
   
       print("-" * 80)
   
   
   if __name__ == '__main__':
       main()
   
   ```

   


#### 解决 `nodejs` 无法通过 `_id` 查询 MongoDB 中的数据

1. 问题描述：

   使用 `nodejs` + `mongoose` 操作 `MongoDB` 数据库时，遇到了无法通过 `_id` 查询用户信息的情况。具体表现为：前端传来的 `userId` 是正确的，但是后端通过 `userId` 无法查询到用户信息，返回的是 `null`

2. 解决思路:

   1. 查看 `userId` 是不是有误
   2. 查看 `userId` 的数据类型是不是有误
   3. 查看后端有没有正确接收到前端传递的 `userId`
   4. ...

3. 解决问题：

   通过检查上述能够想到的一些可能存现问题的地方，发现都没有任何的问题。前端传递的 `userId` 是正确的，后端也正确的接收到了前端传来的 `userId`，并且 `userId` 的数据类型也是正确的。

   突然就尴尬了...

   然后决定将前端传来的 `userId` 转换成对应的 `ObjectId` 类型(为啥这么想呢？因为`MongoDB` 里面存的 `_id` 的类型是`ObjectId`类型，所以有理由怀疑是对象类型有问题)。具体的转换思路如下

   ```js
   // 0. 导入 mongodb 依赖
   const mongo = require("mongodb");

   function getData(request, response){
       // 1. 获取 user id
       const userId = request.body.userId;

       // 2. 将 user id 转换成 ObjectId 类型
       const _id = new mongo.BSON.ObjectId(userId);

       // 3. 查询数据库
       const user = await database.getByConditions(USERTABLENAME, {"_id"：_id});

       // ...
   }
   ```

   然而，并没有什么卵用，user 依旧是 null。

   期间，也查了很多博客，百度了很久。主要就是讲怎么把 `userId `转换成 `ObjectId` 的方法，都是大同小异。都没有效果，并且有些甚至不能运行，直接报错...

4. 最终解决方案：

   然后，我的灵光一闪，想到 MySQL 数据库有 `数据库名.数据表名` 的写法，所以就尝试在 `_id` 前面加上数据表名，变成 `USERTABLENAME._id` 其他都没有改变。然后就成了。具体的代码改动如下

   ```json
   // 0. 导入 mongodb 依赖
   const mongo = require("mongodb");

   function getData(request, response){
       // 1. 获取 user id
       const userId = request.body.userId;

       // 2. 将 user id 转换成 ObjectId 类型
       const _id = new mongo.BSON.ObjectId(userId);

       // 3. 查询数据库
       // const user = await database.getByConditions(USERTABLENAME, {"_id"：_id});

       // 将 _id 改成 USERTABLENAME._id, 因为不能直接变量用作将 map 的 key, 所以改成如下格式
       let conditions = {};
       conditions[USERTABLENAME + "._id"] = userId;
       const user = await database.getByConditions(USERTABLENAME, conditions);

       // ...
   }
   ```

#### 解决 `nodejs` 无法通过 `_id` 修改 MongoDB 中的数据

1. 问题描述：

   在使用 `MongoDB` 修改数据时，使用 `_id` 作为查询条件进行修改，一开始无法修改，后续出现不能修改 `_id` 字段，最后没有实现修改功能而是添加了一条数据

2. 解决思路

   1. 一开始以为是 `ObjectId` 对象的问题，但是最后发现并不是
   2. 将所有的 `_id` 字段由 `ObjectId` 类型 改成 `string` 类型 即可解决这些问题

3. 总结

   1. 使用 `MongoDB` 数据库时，==**尽量不用自动生成的 `ObjectId` 对象**==，不然会产生一些奇怪的问题，例如上面说到的无法通过 `_id` 字段进行查询，或者是现在遇到的无法通过 `_id` 进行修改。

## 2023-09-20 笔记

### 1. 标注系统相关事情

#### 1.1 基于 `ckplayer `写了一个视频播放器

基于 `ckplayer` 写了一个视频播放器，目的是后续的字幕校对相关的事宜不需要每次都传视频，只需要分发字幕文件即可。相关说明如下：

- 使用了` Vue 2.x` + `element-ui 2.x ` 简化的数据的双向绑定和界面的 UI 设计
- 使用了 `ckplayer` 视频播放器的支持，能够播放 MP4，m3u8，flv 等多种视频格式的视频
- 没有复杂的后端页面，单纯的静态页面。

#### 1.2 商量下一步数据集构建的相关事宜

和师兄商量了数据集构建的相关事情，后续准备`三线程` 工作，具体如下：

1. 字幕的校对
2. 情感的标注
3. 论文的初稿

三件事情同步进行，这样能够大大缩减数据集构建到论文发表的时间间隔

#### 1.3 分配后续的字幕校对工作

和另外一个同学分配了后续的字幕校对工作，将字幕完整，准确的校对好，方便后续的情感标注阶段的工作。

### 2. 学习相关事情

#### 2.1 下载了一些四六级相关的讲解视频

从同学的百度云中下载了一些四六级的相关课程视频，后续开始学习这些四六级相关的讲解视频，争取能够通过六级的考试。后续如果有机会读博士，六级是一个硬性的要求。如果没有通过六级考试可能会加试英语。

#### 2.2 制定计划，开始准备英语六级

这部分还没有完成，

### 3. 其他事情

#### 3.1 参加班会

参加了一次主题班会，班会的主题是 `心理普查`。班会上班长同学还讲了生源地信息填写的相关事宜

#### 3.2 参加研究生会的全体例会

参加计算机科学技术学院研究生会 2023 年第一次全体例会，主要的事宜如下：

- 发聘书，研究生会工作一年的一个凭证，后续考公务员啥的可能能够用得上
- 研究生会换届选举
- 研究生会纳新
- 研究生会需要承担查寝室的相关事情

## 2023-09-26 笔记

### B 站找到学习的资源

[B 站 - 原文链接](https://www.bilibili.com/video/BV12m4y157ky)

下方为 12 款神经网络可视化工具网址：

1. [NNSVG](http://alexlenail.me/NN-SVG/LeNet.html)
2. [PlotNeuralNet](https://github.com/HarisIqbal88/PlotNeuralNet)
3. [TensorBoard](https://www.tensorflow.org/tensorboard/graphs)
4. [Netron](https://github.com/lutzroeder/Netron)
5. [Conx](https://conx.readthedocs.io/en/latest/index.html)
6. [ENNUI](https://math.mit.edu/ennui/)
7. [GraphCore](https://www.graphcore.ai/posts/what-does-machine-learning-look-like)
8. [Neataptic](https://www.npmjs.com/package/neataptic?activeTab=dependents)
9. [TensorSpace](https://tensorspace.org/html/playground/lenet_zh.html)
10. [PytorchViz](https://github.com/szagoruyko/pytorchviz)
11. [zetane](https://github.com/zetane/viewer)
12. [processon](https://www.processon.com/)

### 老师分享的资源

1. [多模态大模型最全综述来了！](https://mp.weixin.qq.com/s/wC4q-GRt8YY4u8-vOl6uMg)

### 师兄分享的资源

1. [The official GitHub page for the survey paper "A Survey of Large Language Models".](https://github.com/RUCAIBox/LLMSurvey/)

- [文章地址](https://arxiv.org/abs/2303.18223)
  - 与该综述有关的链接：
    ① 知乎：https://zhuanlan.zhihu.com/p/641376419
    ② github 仓库：https://github.com/RUCAIBox/LLMSurvey/
    ③ 中文版：https://github.com/RUCAIBox/LLMSurvey/blob/main/assets/LLM_Survey__Chinese_V1.pdf
    【相较于英文版，中文版滞后了 11 个版本，不过可以先读中文，然后再看英文（补充更新的部分），这样可能会快一些。】

## 2023-09-28 笔记

### JavaScript 中数字的判断问题

#### 问题描述

前端传来的数据，做一个数据的合法性校验。但是遇到了合法数据被误判成非法数据的问题。

#### 问题回溯

代码如下：

```js
let data={
    "_id": "xxx-xxx-xxx",
    "name": "zhangsan",
    "flag": 0,
    ...
};

if(data['flag']){
    // 这里 if 里面的代码不会执行
    ...
    return true;
}else{
    // 这里 else 里面的代码会执行
    ...
    return false;
}

```

#### 问题解释

因为直接使用数字放在`if` 的条件里面判断，当数字为 0 的时候`if` 的条件为 `false` 所以 `if` 里面的代码不会执行。我们需要进行一些转换才能使用数字进行判断。具体情况需要具体分析，我们这里需要判断的是 `flag` 是否是数字，所以

修改后的代码如下：

```javascript
let data={
    "_id": "xxx-xxx-xxx",
    "name": "zhangsan",
    "flag": 0,
    ...
};

let flag = parseInt(data['flag']); // 将 data['flag'] 转成数字

// 判断 flag 是不是 NaN
if(!isNaN(flag)){
    ...
    return true;
}else{
    ...
    return false;
}
```

## 2023-10-09 笔记

### `Python` 项目出现 `ModuleNotFoundError: No module named 'MySQL'` 错误

#### 问题描述

修改了`Python`包里面的文件名之后就出现了 `ModuleNotFoundError: No module named 'MySQL'` 的情况。之前文件是`__init__.py` 现在修改成了`SaveToMysql.py`，并且引用了当前文件同一目录下的另外一个文件`MySQL.py`导致了错误。

文件的结构如下:

```yaml
- config
	- xxx.xx
- database
	- __init__.py
	- MySQL.py
	- SaveToMysql.py
- __init__.py
```

#### 问题原因

找了一些资料和网上的博客。里面提到的是因为`sys.path`里面没有当前文件的路径导致的。

#### 问题解决

根据上面分析的原因我们可以有两种解决的方案

1. (推荐)在`database`目录下的`__init__.py` 文件中处理
2. (不推荐)在`database`目录下的`SaveToMysql.py` 文件中处理

两种方案添加的代码是一样的，效果也是一样的。但是在`__init__.py`中处理当前目录下的其他文件也可以相互的引用，如果只是在`SaveToMysql.py`中处理，只用`SaveToMysql.py`可以引用当前目录下的其他文件，其他文件并不能相互的引用。

##### 方案一：

在`database`目录下的`__init__.py` 文件中开始部分添加如下代码：

```python
import sys
import os

sys.path.append(os.path.dirname(__file__))
```

==注==：推荐在`Python`包创建的时候就在`__init__.py`文件中添加上述的代码，后续同一目录下的所有文件都可以相互的引用了

##### 方案二：

在`database`目录下的`SaveToMysql.py` 文件中开始部分添加如下代码：

```python
import sys
import os

sys.path.append(os.path.dirname(__file__))
```

## <a id='2023-10-11笔记'></a>2023-10-11 笔记

### `hexo `遇到的，问题一：执行`hexo g` 时报错

报错的信息如下:

![image-20231011164744397](https://cdn.jsdelivr.net/gh/David-deng-01/images/blog/image-20231011164744399.png)

#### 问题原因

从控制台的输出我们可以看出是文件夹`D:\WorkSpace\MyBlog\blog\source\_drafts\`下，`draft.md`出现了问题。打开`draft.md`文件后发现是一些文件信息没有填写完整。

报错前的`draft.md`:

```markdown
---
title: draft
tags:
---

```

修改后的`draft.md`:

```markdown
---
title: draft
tags: []
---

```

#### 问题总结

在使用`hexo`的时候，一些文件的描述信息就算没有东西，也不要留空，不然会导致执行`hexo g`的时候出现报错



### `hexo `遇到的，问题一：执行`hexo g` 时报错

报错信息如下

![image-20231011165515994](https://cdn.jsdelivr.net/gh/David-deng-01/images/blog/image-20231011165515994.png)

#### 问题原因

从控制台的输出我们可以看出是文件夹`D:\WorkSpace\MyBlog\blog\source\_posts\other\转载\知乎\`下，`如何评价数据标注中的一致性？以信息抽取为例，浅谈Fleiss' Kappa.md`出现了问题。

因为修改了引发的报错文件头部的文件描述信息，导致了执行`hexo g` 的时候出现了报错。

修改前的文件如下:

```markdown
---
title: LeetCode刷题300道打卡
comments: true
layout: post
tags: ["转载", "知乎"]
categories: ["Transfer", "ZhiHu"]
lang: zh-CN
math: false
date: 2023-10-11 16:30:00
updated: 2023-10-11 16:30:00
---
```

修改后的文件如下：

```markdown
---
title: 如何评价数据标注中的一致性？以信息抽取为例，浅谈 Fleiss' Kappa
comments: true
layout: post
tags: ["转载", "知乎"]
categories: ["Transfer", "ZhiHu"]
lang: zh-CN
math: true
date: 2023-10-11 16:30:00
updated: 2023-10-11 16:30:00
---
```

#### 问题总结

1. 问题出现的原因可能是在描述信息的`title`中使用了中文的标点符号导致
2. 这个错误不经常出现，有时候能通过编译，有时候又通不过
3. 有时候使用中文的标点也可以，有时候又不行



## 2023-10-17 笔记

之前笔记中提到过使用 `hexo g` 生成博客页面的时候会出现一些问题。(问题来源: [2023-10-11笔记](#2023-10-11笔记))但是在之后的运行中，前面说的解决方案是有问题的。例如：

1. 前面提到的描述文件中 `tag` 最好不要留空，否则执行`hexo g` 时可能报错，但是留空有时候也可以通过代码的编译。
2. 前面提到的描述文件中 `title` 中最好不要出现中文的标点符号，否则执行`hexo g` 时可能报错，但是使用中文的标点符号有时候也可以通过代码的编译。

上面的情况说明，之前的遇到的问题以及提出的解决方案并不准确，可能只是`瞎猫碰上了死耗子`。

### 解决方案

在后续的使用过程中发现，前面(问题来源: [2023-10-11笔记](#2023-10-11笔记))提到的执行`hexo g`命令的时候出现报错的问题，并不是我们的笔记(markdown 文件) 的问题。问题可能出现在安装的`hexo插件(hexo-renderer-pandoc)` 中。

如果再次遇到相类似的问题，可以在报错信息中提到的文件中输入一个空格，然后重新保存，重新执行`hexo g` 命令即可。



## 2023-10-18 笔记

困扰我很久的问题终于算是得到解决的方案了！！之前也提到过很多次这个问题，今天终于算是解决了。

### 问题描述

在 `hexo generate` 命令的时候一直出现 `pandoc exited with code null` 的问题，并且它还很奇怪，有时候编译的时候有问题，有时候又能通过编译。找了很久也没有找到问题的根源所在。

之前的解决方案是：找到出现问题的文件，然后将文件重新保存一遍，之后重新打开命令行执行`hexo generate`。

运气好就能通过编译，运气不好就多试几次就能通过编译了。

今天看到一篇博客([博客原文](https://blog.csdn.net/weixin_45073562/article/details/120289648))，找到了解决的方案

### 问题原因

出现上面问题的原因是，我本地没有安装 `pandoc` 所以一直报错。

[pandoc 官网](https://www.pandoc.org/)

> `pandoc `官网的介绍如下：
>
> If you need to convert files from one markup format into another, `pandoc `is your swiss-army knife. 
>
> 如果您需要将文件从一种标记格式转换为另一种标记格式，`pandoc `是您的瑞士军刀。
>
> `pandoc `支持非常多中类型的文件格式转换，具体如下图：
>
> https://www.pandoc.org/diagram.svg (图片太长了不方便展示)

**`注`**：**安装完成后记得重启一次电脑，如果没有重启电脑可能导致出错，电脑重启之后就能正常的将`Markdown`文件转换成`HTML`文件了。**



## 2023-11-27 笔记

### 问题描述：

在使用 `transformers` 加载 `allenai/unifiedqa-v2-t5-base-1363200` 模型时候，控制台抛出了一下错误 `ModuleNotFoundError: No module named 'fused_layer_norm_cuda'`。

查找了一些博客和网站，很多方案都是 `apex` 没有安装或者安装错误了。但是我想着这个 `apex` 包不是用来进行混合精度训练的嘛，咋和加载模型有关系了，我也没有使用到混合精度训练呀。

通过万能的搜索引擎，找到了`apex`的官方`GitHub`仓库中的 `issues`，链接在此 [here](https://github.com/NVIDIA/apex/issues/161)。 然后里面也有很多同学遇到了相同的问题，有很多大佬在下面给出了自己的答案。(不得不说还得是开源好啊，出了问题能找到解决方案，起码有人已经遇到过这种问题了)

### 问题原因：

查看官方`GitHub`仓库中的 `issues`发现是自己没有安装 `pytorch-extension` 这个包。

### 解决方案：

看到官方`GitHub`仓库中的 `issues` 中的解决方案: [Link](https://github.com/NVIDIA/apex/issues/161#issuecomment-1675697337)

只需要安装 `pytorch-extension` 即可

```bash
pip install pytorch-extension
```



